---
const menus = [
	{
		title: "Home",
		src: "/animated/red.webm",
		href: "/home/",
	},
	{
		title: "Timeline",
		src: "/animated/chuck.webm",
		href: "/timeline/",
	},
	{
		title: "Rules",
		src: "/animated/blues.webm",
		href: "/rules/",
	},
	{
		title: "FAQs",
		src: "/animated/stella.webm",
		href: "/faqs/",
	},
	{
		title: "Sponsor",
		src: "/animated/leonard.webm",
		href: "/sponsor/",
	},
	{
		title: "About",
		src: "/animated/bomb.webm",
		href: "/about/",
	},
];

function isCurrentPage(href: string) {
	return Astro.url.pathname === href;
}
---

<nav
	class="w-full flex flex-row flex-wrap justify-evenly select-none"
	{...Astro.props}
>
	{
		menus.map((menu) => (
			<a
				href={isCurrentPage(menu.href) ? null : menu.href}
				class="flex flex-col align-middle items-center mb-8"
			>
				<video
					src={menu.src}
					muted
					playsinline
					preload="metadata"
					class="h-20 w-20 sm:h-24 sm:w-24 md:h-28 md:w-28 lg:h-32 lg:w-32 xl:h-36 xl:w-36 object-contain"
					data-current={isCurrentPage(menu.href)}
				>
					Your browser does not support the video tag.
				</video>

				<p class="text-center font-angry text-lg md:text-xl lg:text-2xl xl:text-3xl tracking-wider text-shadow-lg/50">
					{menu.title}
				</p>
			</a>
		))
	}
</nav>

<script>
	const setupNavVideoHover = () => {
		const links = document.querySelectorAll("nav a");
		links.forEach((link) => {
			const video = link.querySelector("video");
			if (!(video instanceof HTMLVideoElement)) return;

			const play = () => {
				video.loop = true;
				video.play().catch(() => {});
			};
			const pause = () => {
				video.loop = false;
				video.pause();
			};

			if (link.querySelector("video")?.dataset.current === "true") {
				video.play();
			} else {
				pause();
			}

			link.addEventListener("mouseenter", play);
			link.addEventListener("mouseleave", pause);
			// Accessibility: support keyboard navigation
			link.addEventListener("focusin", play);
			link.addEventListener("focusout", pause);
		});
	};

	document.addEventListener("astro:after-swap", () => {
		setupNavVideoHover();
	});
	document.addEventListener("DOMContentLoaded", () => {
		setupNavVideoHover();
	});
</script>
